# Составные типы данных
## Массивы


Столбцы в таблице в `PostgreSQL` могут представлять массивы, например, массивы чисел INTEGER или массивы строк VARCHAR или массивы других типов данных. 

Рассмотрим, как работать с массивами в PostgreSQL.

Вначале определим простейшую таблицу:

```sql
create table posts(
    id serial primary key,
    title varchar(30),
    body text,
    tags varchar(10)[]
);
```

Таблица posts будет хранить условные статьи, где столбец `title` хранит заголовок статьи, `body` - ее текст, а `tags` - список тегов статьи. 

Причем столбец `tags` представляет массив данных `varchar(10)`, то есть строк. 

Для определения массива после названия типа указываются квадратные скобки.

Добавим в эту таблицу одну статью с набором тегов:

```sql
insert into posts(title, body, tags)
values('Post Title', 'Post Text', '{"sql", "postgres", "database", "plsql"}');
```

Массив определяется в кавычках, как и строка, но внутри кавычек все элементы массива помещаются в фигурные скобки. 

Каждый отдельный элемент массива заключается в двойные кавычки. 

То есть в данном случае в массиве четыре элемента: 

`"sql", "postgres", "database" и "plsql"`.

Как и данные любого другого столбца, мы можем извлечь данные массива:

```sql
select tags from posts;
```


Однако с помощью индексов мы также можем конкретизировать, какие именно элементы массива мы хотим получить:

```sql
select tags[0:3] from posts;
```

Индексы указываются в скобках через двоеточие. 

Вначале идет индекс начала диапазона, а затем индекс конца диапазона. 

То есть в данном случае извлекаем три тега с первого по третий.

При обновлении строки мы можем изменять как в целом все теги, так и какие-то конкретные теги. Например, удалим все теги:


```sql
update posts 
set tags='{}'
where id=1;
```

Переустановим массив:

```sql
update posts 
set tags='{"sql", "postgres", "database"}'
where id=1;

```
Переустановим конкретный элемент, например, второй:


```sql
update posts 
set tags[2]='system'
where id=1;
```

## Перечисления enum

`PostgreSQL` имеет специальный тип данных, который называется enum и который представляет набор констант. 

И столбец подобного типа может в качестве значения принимать одну из этих констант. 

Рассмотрим, как использовать перечисления.

Для создания перечисления используется команда `CREATE TYPE`. 

Например, создадим простейшее перечисление:

```sql
create type request_state as enum ('created', 'approved', 'finshed');
```

Данное перечисление называется `"request_state"`. 

После слова `enum` в скобках указывается через запятую список констант, которые составляют данное перечисление. 

То есть в данном случае перечисление `request_status` может принимать три значения: `'created', 'approved', 'finshed'`.

После создания перечисления мы можем использовать его в качестве типа столбца. 

Например, создадим следующую таблицу:

```sql
create table requests(
    id serial primary key,
    title varchar(30),
    status request_state
);
```

Здесь третий столбец - `status` представляет перечисление `request_state` и может принимать одно из трех выше указанных значений. 

Поэтому при добавлении данных нужно указать для данного столбца одно из этих трех значений:


```sql
insert into requests(title, status)
values ('Request 1', 'created');
```


При этом важно, что столбец может иметь только одно из этих трех значений, а не какие-то произвольные значения. 

Кроме того, большую роль играет регистр символов, например, `"created"` не эквивалентно `"Created"`.


При обновлении данных также необходиом предоставить одно из значений перечисления:

```sql
update requests 
set status='approved'
where id=1;
```

## Изменение перечисления

После создания перечисления вполне возможно нам захочется его изменить, например, добавить новое значение. 

Для этого применяется команда `ALTER TYPE`.

Добавление нового значения:

```sql
ALTER TYPE request_state ADD VALUE 'blocked';
```


К сожалению, удалить так просто уже имеющееся значение из перечисления не получится.

В этому случае мы можем создать новое перечисление и указать, чтобы таблица использовала именно новое перечисление:


```sql
CREATE TYPE status_enum AS ENUM('created', 'approved', 'done');
 
ALTER TABLE requests ALTER COLUMN status TYPE status_enum 
USING status::text::status_enum;
```

### Удаление


Если перечисление больше не нужно, то с помощью команды DROP TYPE его можно удалить:

```sql
DROP TYPE request_state;
```