## Модификация данных

Оператор `UPDATE` изменяет значения атрибутов в хранимой таблице. 

За ключевым словом `UPDATE` следуют имя таблицы и предложение `SET`, содержащее список имен изменяемых атрибутов из этой таблицы с указанием выражений, задающих для них новые значения. 

Далее следует предложение `WHERE` (такое же, как в операторе `SELECT`), которое определяет, какие строки будут обрабаты-
ваться данным оператором. 

Если предложение `WHERE` не указано, изменению подвергаются все строки таблицы.


Оператор `UPDATE` часто используется для изменения только одной строки таблицы, хотя SQL допускает указание условий, которым удовлетворяет несколько строк. 

Отметим также, что для изменения значения не требуется его предварительное считывание в приложение оператором SELECT: выражение, вычисляющее новое значение атрибута, может содержать имя этого атрибута, при этом для вычисления нового значения будет использоваться старое. 

Новое значение может задаваться подзапросом, эта возможность более детально обсуждается ниже.
Например, оператор

```sql
UPDATE courses
SET hours = hours * 2
WHERE c_no = 'CS301';
```

увеличивает на единицу значение одного атрибута в одной строке. 

Оператор `DELETE` удаляет строки из хранимой таблицы, имя которой указывается в предложении FROM, а строки, подлежащие удалению, задаются предложением `WHERE`. 

Как и для операторов `SELECT` и `UPDATE`, отсутствие предложения `WHERE` означает, что должны быть обработаны (т. е. удалены) все строки таблицы. 

Так же как и оператор `UPDATE`, чаще всего оператор `DELETE` используется для удаления только одной строки.

Так, оператор
```sql
DELETE FROM courses
WHERE course_no = 'CS305';
```

удаляет одну строку таблицы (так как условие задает значение первичного ключа).


```sql
DELETE FROM exams WHERE score < 5;
```

## Предложение ON CONFLICT

Ситуация: при вставке новых строк могут возникать ситуации, когда нарушается ограничение первичного или уникального ключей, поскольку вставляемые строки могут иметь значения ключевых атрибутов,совпадающие с теми, что уже имеются в таблице.

> Решение: использовать предложение `ON CONFLICT`.

Оно предусматривает два варианта действий:

* отменять добавление новой строки, для которой имеет место конфликт значений ключевых атрибутов, и при этом не порождать сообщения об ошибке – `DO NOTHING`;

* заменять операцию добавления новой строки операцией обновления существующей строки, с которой конфликтует добавляемая строка – `DO UPDATE`.

В том случае, когда в предложении ON CONFLICT не указана дополнительная информация об именах столбцов или ограничений, по которым предполагается возможный конфликт, проверка выполняется по первичному ключу и по уникальным ключам.

```sql
INSERT INTO courses (c_no, title, hours) VALUES
('CS307', 'ОАИП', '120')
```


```sql
INSERT INTO courses (c_no, title, hours) VALUES
('CS307', 'ОАИП', '120')
--ERROR:  Ключ "(c_no)=(CS307)" уже существует
```

Решение 
```sql
INSERT INTO courses (c_no, title, hours) VALUES
('CS308', 'ОАИП', '120')
ON CONFLICT DO NOTHING
RETURNING *;
```

Сообщение было выведено потому, что в команду включено предложение `RETURNING *`. 

```sql
INSERT INTO courses (c_no, title, hours) VALUES
('CS308', 'ОАИП-2', '40')
ON CONFLICT ON CONSTRAINT courses_pkey
DO UPDATE SET title = excluded.title, hours = excluded.hours
RETURNING *;
```